<%= render "products/build/product_progress" %>

<div class="form-wrapper">

	<%= simple_form_for @product, url: wizard_path, method: :put do |f| %>

		<div class="form-inputs">
			<ul class="image-upload">
				<li>
					<%= f.input :image1, as: :file %>
					<div class="image-button">
						<i class="fa fa-times fa-lg" aria-hidden="true"></i>
					</div>
					<div class="image-button-text">
						<i class="fa fa-plus fa-2x" aria-hidden="true"></i>
						<br />
						Primary image
					</div>
				</li>
				<li>
					<%= f.input :image2, as: :file %>
					<div class="image-button">
						<i class="fa fa-times fa-lg" aria-hidden="true"></i>
					</div>
					<div class="image-button-text">
						<i class="fa fa-plus fa-2x" aria-hidden="true"></i>
						<br />
						Additional image
					</div>
				</li>
			</ul>

			<br />
			<br />
			<br />
			<br />
			<br />
			<br />
			<br />
			<br />
			<br />

			<%= f.input :name, label: "Product name" %>
			<%= f.input :description, label: "One-line description" %>
			<%= f.input :price, label: "Full price" %>
			<%= f.input :rebate %>
			<%= f.input :quantity %>
			<%= f.input :story, :as => :ckeditor, :input_html => { :ckeditor => {:toolbar => 'mini'} } %>
		</div>

		<div class="form-actions">
	    <%= f.button :submit, "Next" %>
	  </div>
	  <div class="previous-step">
	  	<i class="fa fa-arrow-left" aria-hidden="true"></i><%= link_to "Prev", previous_wizard_path %>
	  </div>
	<% end %>
</div>

<script>
	$(function() {
	  $('.file').on('change', function(event) {
	    var files = event.target.files;
	    var image = files[0];
	    var reader = new FileReader();
	    var original = $(this);
	    reader.onload = function(file) {
	      var img = new Image();
	      img.src = file.target.result;
	      $(original).next().css("background-image", "url(" + img.src + ")");
	      $(original).next().find('.fa-times').css("display", "inline-block");
	    }
	    reader.readAsDataURL(image);
	  });
	});

  $('.fa-times').click(function(event) {
    $(this).css("display", "none");
    $(this).parent().css("background-image", "none");
    $(this).parent().prev().find('input').wrap('<form>').closest('form').get(0).reset();
  	$(this).parent().prev().find('input').unwrap();
  	$(this).parent().prev().find('input').stopPropagation();
  	$(this).parent().prev().find('input').preventDefault();
  });
</script>